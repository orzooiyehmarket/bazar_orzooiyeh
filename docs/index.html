<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>بازار ارزوئیه</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f0f0;
    }
    header {
      background: linear-gradient(to left, #ff8a00, #e52e71);
      color: white;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      margin: 0;
      font-size: 24px;
    }
    #clock {
      font-size: 18px;
    }
    .container {
      padding: 20px;
    }
    .input-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input, textarea, button {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .buttons {
      display: flex;
      justify-content: space-around;
      gap: 10px;
    }
    .product-image {
      display: block;
      max-width: 80%;
      margin: 20px auto;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    .nav {
      position: fixed;
      top: 0;
      right: -100%;
      width: 80%;
      height: 100%;
      background: white;
      box-shadow: -2px 0 5px rgba(0,0,0,0.2);
      padding: 20px;
      transition: right 0.3s ease;
      z-index: 999;
    }
    .nav.active {
      right: 0;
    }
    .nav a {
      display: block;
      margin-bottom: 15px;
      font-size: 18px;
      color: #333;
      text-decoration: none;
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.3);
      display: none;
      z-index: 998;
    }
    .overlay.active {
      display: block;
    }
  </style>
</head>
<body>

<header>
  <h1>بازار ارزوئیه</h1>
  <div id="clock"></div>
</header>

<div class="container">
  <div class="input-group">
    <label>نام محصول</label>
    <input type="text" id="name">
  </div>
  <div class="input-group">
    <label>قیمت</label>
    <input type="number" id="price">
  </div>
  <div class="input-group">
    <label>فروشنده</label>
    <input type="text" id="seller">
  </div>
  <div class="input-group">
    <label>تماس با فروشنده</label>
    <input type="text" id="phone">
  </div>
  <div class="input-group">
    <label>آدرس</label>
    <textarea id="address"></textarea>
  </div>
  <div class="input-group">
    <label>تصویر محصول</label>
    <input type="file" id="image" accept="image/*">
  </div>
  <img id="preview" class="product-image" style="display:none">

  <div class="buttons">
    <button onclick="handleSave()">ذخیره</button>
    <button onclick="handleShare()">اشتراک‌گذاری واتساپ</button>
    <button onclick="openNav()">منو</button>
  </div>
</div>

<div class="nav" id="nav">
  <a href="#">اشتراک‌گذاری</a>
  <a href="#">درباره ما</a>
  <a href="#">تماس با ما</a>
</div>
<div class="overlay" id="overlay" onclick="closeNav()"></div>

<script>
function updateClock() {
  const now = new Date();
  const date = now.toLocaleDateString('fa-IR');
  const time = now.toLocaleTimeString('fa-IR');
  document.getElementById('clock').textContent = `${date} - ${time}`;
}
setInterval(updateClock, 1000);
updateClock();

function openNav() {
  document.getElementById('nav').classList.add('active');
  document.getElementById('overlay').classList.add('active');
}
function closeNav() {
  document.getElementById('nav').classList.remove('active');
  document.getElementById('overlay').classList.remove('active');
}

document.getElementById('image').addEventListener('change', function() {
  const reader = new FileReader();
  reader.onload = function(e) {
    document.getElementById('preview').src = e.target.result;
    document.getElementById('preview').style.display = 'block';
  };
  reader.readAsDataURL(this.files[0]);
});

async function uploadToImgur(file) {
  const formData = new FormData();
  formData.append("image", file);
  const response = await fetch("https://api.imgur.com/3/image", {
    method: "POST",
    headers: {
      Authorization: "Client-ID d4f989174bc6952"
    },
    body: formData
  });
  const data = await response.json();
  return data.data.link;
}

async function handleSave() {
  const obj = collectData();
  await fetch("https://script.google.com/macros/s/AKfycbyHUiGDSpKq6_vsC5jgc7Q0H9yX98KHDKZhT2O_gHze8-yniK_oLqOg3vwE7tQVeoMlHg/exec", {
    method: "POST",
    body: JSON.stringify(obj),
    headers: {
      "Content-Type": "application/json"
    }
  });
  alert("با موفقیت ذخیره شد.");
}

function collectData() {
  const now = new Date();
  const date = now.toLocaleDateString('fa-IR');
  const code = `${now.getFullYear()}${now.getMonth()+1}${now.getDate()}${Math.floor(Math.random()*1000)}`;
  return {
    name: document.getElementById('name').value,
    price: document.getElementById('price').value,
    seller: document.getElementById('seller').value,
    phone: document.getElementById('phone').value,
    address: document.getElementById('address').value,
    date,
    code
  };
}

async function handleShare() {
  const imageFile = document.getElementById('image').files[0];
  const imageLink = await uploadToImgur(imageFile);
  const obj = collectData();
  const message = `${imageLink}\n\nنام ${obj.name}\nقیمت ${obj.price}\nفروشنده ${obj.seller}\nتماس ${obj.phone}\nآدرس ${obj.address}\nتاریخ ${obj.date}\nکد ${obj.code}`;
  const url = `https://wa.me/989136666552?text=${encodeURIComponent(message)}`;
  window.open(url, '_blank');
}
</script>

</body>
</html>
